---
layout: default
title: 便签
---

<div class="tag-filter-box">
  <div class="selected-tags"></div>
  <div class="all-tags"></div>
</div>

<ul class="notes">
{% for note in site.data.notes %}
<li class="note" 
    id="t{{ note.date | date: "%Y%m%d%I%M" }}"
    data-tags="{{ note.tags | join: ',' | downcase }}">
  <!-- 原有内容保持不变 -->
  {% if note.tags %}
  <div class="note-tags">
    {% for tag in note.tags %}
    <span class="tag">{{ tag }}</span>
    {% endfor %}
  </div>
  {% endif %}
</li>
{% endfor %}
</ul>

<style>
/* 新增标签选择样式 */
.tag-filter-box {
  position: sticky;
  top: 1rem;
  background: rgba(255,255,255,0.9);
  padding: 1rem;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  margin-bottom: 2rem;
}

.all-tags {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.tag-checkbox {
  display: none;
}

.tag-label {
  display: inline-block;
  padding: 6px 12px;
  background: #f0f0f0;
  border-radius: 16px;
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}

.tag-label:hover {
  background: #e0e0e0;
}

.tag-label.active {
  background: #2196F3;
  color: white;
  transform: scale(1.05);
}

.selected-tags {
  margin-bottom: 1rem;
  min-height: 32px;
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}

.selected-tag {
  background: #2196F3;
  color: white;
  padding: 4px 12px;
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.selected-tag::after {
  content: "×";
  cursor: pointer;
  opacity: 0.6;
}

.selected-tag:hover::after {
  opacity: 1;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
  // 获取所有标签
  const notes = document.querySelectorAll('.note');
  const allTags = [...new Set(
    Array.from(notes).flatMap(note => 
      note.dataset.tags.toLowerCase().split(',')
  )].filter(Boolean);

  // 生成标签选择器
  const tagContainer = document.querySelector('.all-tags');
  const selectedContainer = document.querySelector('.selected-tags');
  
  allTags.forEach(tag => {
    const label = document.createElement('label');
    label.className = 'tag-label';
    label.textContent = tag;
    label.dataset.tag = tag;
    
    label.addEventListener('click', () => {
      label.classList.toggle('active');
      updateSelectedTags();
      filterNotes();
    });
    
    tagContainer.appendChild(label);
  });

  // 更新已选标签显示
  function updateSelectedTags() {
    selectedContainer.innerHTML = '';
    const activeTags = document.querySelectorAll('.tag-label.active');
    
    activeTags.forEach(label => {
      const span = document.createElement('span');
      span.className = 'selected-tag';
      span.textContent = label.textContent;
      span.dataset.tag = label.dataset.tag;
      
      span.addEventListener('click', () => {
        document.querySelector(`[data-tag="${span.dataset.tag}"]`)
          .classList.remove('active');
        filterNotes();
      });
      
      selectedContainer.appendChild(span);
    });
  }

  // 过滤便签
  function filterNotes() {
    const activeTags = [...document.querySelectorAll('.tag-label.active')]
      .map(label => label.dataset.tag);
    
    notes.forEach(note => {
      const noteTags = note.dataset.tags.split(',');
      const shouldShow = activeTags.length === 0 || 
        activeTags.every(tag => noteTags.includes(tag));
      
      note.style.display = shouldShow ? 'block' : 'none';
    });
  }

  // 初始显示所有便签
  filterNotes();
});
</script>